# Implementation Plan: Web UI + API

## Overview
Phase 2: プレイヤー検索API と モバイルファーストWeb UIの実装

---

- [x] 1. データベース検索クエリの実装
- [x] 1.1 プレイヤー名検索機能の実装
  - 名前（first_name または last_name）で部分一致検索する機能を作成
  - 国（country）による完全一致フィルターを追加（オプション）
  - Division による絞り込み機能を追加（オプション）
  - 検索結果に各プレイヤーの大会参加回数を含める
  - デフォルト100件、最大500件の制限を設ける
  - ユニットテストを作成（部分一致、フィルター組み合わせ、空結果、limit境界値）
  - _Requirements: 検索条件（Name部分一致、Country、Division）_

- [x] 1.2 参加記録取得機能の実装
  - 指定プレイヤーの大会参加記録を取得する機能を作成
  - 大会情報（名前、開催日、開催地）を結合して返す
  - 開催日の新しい順（降順）でソートする
  - Division によるフィルター機能を追加（オプション）
  - 同名別人判別用の情報（Player ID、Division、Country）を含める
  - ユニットテストを作成（降順ソート確認、Divisionフィルター、存在しないプレイヤー）
  - _Requirements: 検索結果表示、ソート順（開催日降順）、同名別人判別情報_

- [x] 2. APIサーバーの実装
- [x] 2.1 Honoサーバーの基盤構築
  - Hono と @hono/node-server をプロジェクトに追加
  - APIサーバーのエントリーポイントを作成（ポート3000）
  - ヘルスチェックエンドポイント（GET /api/health）を実装
  - エラーハンドリングミドルウェアを設定
  - npm scripts に `dev:api` コマンドを追加
  - _Requirements: バックエンドAPI実装_

- [x] 2.2 プレイヤー検索APIエンドポイントの実装
  - GET /api/players/search エンドポイントを作成
  - クエリパラメータのバリデーション（name必須、limit範囲チェック）
  - バリデーションエラー時は400レスポンスを返す
  - 検索結果をJSON形式で返す（players配列、total件数）
  - ユニットテストを作成（正常系、バリデーションエラー）
  - _Requirements: 検索条件、バリデーション（name必須、limit範囲）_

- [x] 2.3 参加記録取得APIエンドポイントの実装
  - GET /api/players/:id/participations エンドポイントを作成
  - プレイヤーが存在しない場合は404レスポンスを返す
  - Divisionフィルターのクエリパラメータ対応
  - プレイヤー情報と参加記録をJSON形式で返す
  - ユニットテストを作成（正常系、404エラー、Divisionフィルター）
  - _Requirements: 検索結果表示、同名別人判別情報_

- [x] 2.4 API統合テストの作成
  - 検索から参加記録取得までの一連のフローをテスト
  - 実際のデータベースを使用した統合テスト
  - エラーケース（400、404）の検証
  - _Requirements: 全API機能の統合確認_

- [x] 3. フロントエンド環境構築
- [x] 3.1 React + Vite プロジェクトの初期化
  - web/ ディレクトリに Vite + React + TypeScript プロジェクトを作成
  - モバイルファーストのベーススタイルを設定（max-width: 400px、中央配置）
  - Vite の proxy 設定で /api を localhost:3000 に転送
  - npm scripts に `dev:web` コマンドを追加
  - _Requirements: フロントエンド実装（React + Vite）、モバイルファースト_

- [x] 3.2 共通型定義とAPIクライアントの作成
  - フロントエンド用の型定義を作成（PlayerSearchResult、ParticipationWithEvent等）
  - fetch APIを使用したAPIクライアント関数を作成
  - エラーハンドリングのユーティリティを作成
  - _Requirements: API連携基盤_

- [x] 4. 検索機能UIの実装
- [x] 4.1 検索フォームコンポーネントの作成
  - 名前入力欄（1つのテキストフィールド）を作成
  - Country選択（オプション、ドロップダウン）を作成
  - Division選択（オプション、デフォルト:全て）を作成
  - 検索ボタンとローディング状態の表示
  - タッチ操作に適したサイズ（44px以上）で設計
  - _Requirements: 検索条件（Name、Country、Division）_

- [x] 4.2 プレイヤー一覧コンポーネントの作成
  - 検索結果のプレイヤー一覧を表示
  - 各プレイヤーカードに名前、国、参加回数を表示
  - プレイヤー選択時のハイライト表示
  - 検索結果が0件の場合のメッセージ表示
  - _Requirements: プレイヤー候補一覧表示_

- [x] 4.3 検索状態管理フックの作成
  - 検索パラメータ、検索結果、ローディング状態を管理
  - API呼び出しとエラーハンドリング
  - 選択中プレイヤーの状態管理
  - _Requirements: 検索機能の状態管理_

- [x] 5. 参加記録表示UIの実装
- [x] 5.1 参加記録一覧コンポーネントの作成
  - 選択プレイヤーの大会参加記録を一覧表示
  - 各記録に大会名、開催日、順位、Division、デッキリンクを表示
  - 同名別人判別用情報（Player ID、Country）を表示
  - デッキリストURLがある場合は外部リンクとして表示
  - 開催日の新しい順で表示されることを確認
  - _Requirements: 検索結果表示、ソート順、同名別人判別情報_

- [x] 5.2 参加記録取得フックの作成
  - プレイヤー選択時に参加記録を取得
  - ローディング状態とエラー状態の管理
  - Divisionフィルターの適用
  - _Requirements: 参加記録表示の状態管理_

- [x] 6. アプリケーション統合
- [x] 6.1 メインアプリコンポーネントの統合
  - 検索フォーム、プレイヤー一覧、参加記録一覧を統合
  - 全体のレイアウト調整（モバイル幅、中央配置）
  - エラーメッセージの統一的な表示
  - ローディング状態のUI表示
  - _Requirements: 検索・結果表示画面_

- [x] 6.2 開発環境の統合とスクリプト整備
  - concurrently を使用した API + Web 同時起動スクリプトを追加
  - `npm run dev` で両方を起動できるように設定
  - 開発時の動作確認と調整
  - _Requirements: 開発環境の整備_

- [x] 7. E2Eテストの作成
- [x] 7.1 主要フローのE2Eテスト
  - 名前検索からプレイヤー一覧表示までのフロー
  - プレイヤー選択から参加記録表示までのフロー
  - フィルター（Country、Division）の動作確認
  - エラー表示（検索結果0件、ネットワークエラー）の確認
  - _Requirements: 全機能の動作検証_
